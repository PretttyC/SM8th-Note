# 网络核心

* 网络核心：由分组交换设备和链路组成的网络
* 报文：端系统之间交互的数据称报文
* 分组：报文会被划分为较小的数据块，称分组

每个分组都通过链路和分组交换机进行传输。  
**分组交换机**主要有路由器、链路层交换机两类。

## 信息交换方式
```plantuml
@startmindmap
* 信息交换方式

** 分组交换
*** 存储转发传输机制(以分组为单位)
****_ **分组交换机**必须在接收完整个分组后，才开始向链路输出第一个bit
**** 存储转发时延
*****_:\
两条速率为R(1台路由器)的链路组成的路径，发送一个分组(一个分组L个bit)所需要的时延为2L/R
若没有存储转发时延，则总时延为L/R;

*** 排队时延和分组丢失
****_ 分组交换机有一个输出缓存，称输出队列
**** 排队时延
*****_ 待转发的分组需要在输出队列中排队，分组在输出队列中等待的时间称排队时延
**** 分组丢包
*****_ 输出缓存的空间大小有限，若缓存已满，则新到的分组或已排队的分组之一会被丢失

*** 转发表和路由选择协议
**** 转发表
*****_ 每台路由器具有一个转发表，用于将目的IP地址映射为输出链路
**** 路由选择协议
*****_ 路由选择协议用于自动设置转发表(而不是人工对每台路由器进行配置)

***:\
=分组交换根据**“网络层”**提供的是有连接还是无连接，有两种方式
(传输层能够为应用程序提供无连接服务或面向连接服务。
类似的，网络层也能够提供无连接服务或连接服务。
网络层的连接和无连接服务在许多方面等同于传输层的面向连接和无连接服务);
**** 虚电路(有连接)
*****_:\
在数据传输前需建立一条逻辑上的连接（虚电路），每个分组携带虚电路号而不是IP地址，所有数据分组沿该路径按序传输，结束后释放连接
=有连接 != 面向连接，有连接指整条通信路径上都要维护通信状态(发送方主机、接收方主机、中间的路由器)，而传输层TCP提供的面向连接只需要发送方主机和接收方主机之间来维护通信状态。
如以前ATM网络，现已废弃;
**** 数据报(无连接)
*****_:\
数据报是无连接的服务，每个分组独立发送，携带完整目的地址，路径由各节点动态选择
在数据报网络中，每当一个端系统要发送分组时，它就为该分组加上目的地端系统的地址，然后将该分组推进网络中;

*** 统计时分复用(STDM)
****_ 分组交换的链路复用相当于是统计时分复用：根据用户实际需求动态分配时隙或带宽，而非固定预分配


** 电路交换(或称线路交换)
***_:\
端系统通信期间，预留了系统间沿路径通信所需要的资源(缓存、链路、传输速率)，在发送方发送信息前，网络在发送方和接收方之间建立一条专用的端到端连接(这条连接称电路)。
传统电话就是电路交换;
*** 电路交换链路的复用
**** 频分复用(FDM)
*****_:\
按频率划分为多个频段，每条链路使用一个频段。频段的宽度称**带宽**。
无线电台使用FDM来共享88MHz~108MHz的频谱;
**** 时分复用(TDM)
*****_:\
时间被划分为固定时段的帧，每个帧划分为固定数量的时隙。每条链路使用一个时隙。
如：一个具有24时隙的TDM，比特速率为1.536Mbps，则每条链路的速率为1.536Mbps / 24 = 64Kbps;
@endmindmap
```

## 因特网ISP分层
```plantuml
@startmindmap
* 因特网
** 第一层ISP(顶层)
***_ 用于国家、国际的互联，速率极高。如AT&T
** 第二层ISP
**_ ......
** 接入ISP
** 端系统
@endmindmap
```

* 上下层互联  
上层ISP是下层ISP的提供商，下层ISP是上层ISP的客户。下层ISP需要给上层ISP付费。  
下层ISP通过上层ISP提供的PoP(Point Of Presence, 接入点)来接入。PoP是提供商网络中的一台路由器或路由器群。  
下层ISP可以同时接入多个不同的ISP的PoP，称为多宿(multi-home)。  

* 对等层互联  
同层级的ISP之间的关系是对等(peer)，对等的ISP之间可以直接连接，也可以通过汇总接入第三方公司创建的IXP(Internet Exchange Point, 因特网交换点)来实现对等。  
一般对等的ISP之间可以互相不付费。  

* 内容提供商  
内容提供商(如谷歌)，可能在全球不同的地区部署不同的数据中心，这些数据中心通过企业内部专线来互联。  
它们接入互联网的方式更倾向于与低层ISP对等接入，这样可以绕过高层的ISP(也有一些接入ISP必须通过高层ISP才能访问)，减少向高层ISP付费。  