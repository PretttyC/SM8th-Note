# 分组交换中的时延、丢包和吞吐量

## 节点时延分类

节点总时延: $d_{nodal}$  
节点处理时延: $d_{proc}$  
排队时延: $d_{queue}$  
传输时延: $d_{trans}$  
传播时延: $d_{prop}$  

$d_{nodal} = d_{proc} + d_{queue} + d_{trans} + d_{prop}$

```plantuml
@startmindmap
* 节点总时延
** 处理时延
***_ 对分组数据做处理，如检查分组手部决定其导向何处、差错校验
** 排队时延
***_ 分组在缓存队列中排队的时间
***_ 到达分组期待发现的分组数量是到达该队列的流量强度和性质的函数
** 传输时延
***_ 比特被推向或发射到链路上的速率，单位为bps或者bit/s；分组长度为L，链路速率为R，则传输时延为L/R
***_ 传输时延只与分组长度和两路速率有关，和距离无关
** 传播时延
***_ 比特在介质中的传播速率。传播速率取决于物理介质，如光纤的传播速率接近于光速。节点之间的距离为d，介质传播速率为s，则传播时延为d/s
***_ 传播时延只与距离和传播速率有关
@endmindmap
```

## 排队时延

* 流量的性质  
指流量是周期性到达还是突发性到达。

* 流量强度  
若分组的长度为L bit，分组到达队列的平均速率为a pkt/s(分组每秒)，节点的传输速率为R bit/s，则La/R称为流量强度。  

![平均排队时延与流量强度的关系.png](../images/平均排队时延与流量强度的关系.png){width="400"}

```plantuml
@startmindmap
* 流量强度La / R
** La / R -> 0(趋近于0)
*** 几乎没有分组到达，且间隔很大。平均排队延时接近于0
** La / R -> 1(趋近于1)
***:\
===流量强度接近于1的情况下，由于分组的到达速率是波动的，到达速率大于传输速率时，队列长度增加；到达速率小于传输速率时，队列长度缩小。
===流量强度接近于1的情况下，强度的少量增加会导致延时大幅增加
===流量强度接近于1的情况下，由于分组到达的**随机性**，长时间看，排队长度会越来越长(如果分组是周期性达到，则不会，正是由于随机性，且强度的少量增加会导致延时大幅增加，长期来看排队会越来越长)。;
** La / R > 1(大于1)
*** 比特到达的速率超过传输出去的速率，此时队列趋向于无限增加，排队延时趋向于无穷大。
@endmindmap
```

## 丢包

流量强度接近于1时，排队时延不会无限增加，当队列已满时，分组会被丢弃。

一个节点的性能不仅看时延，还要看丢包的概率。

## 端到端时延

假设：
* 源主机和目的主机之间有N条链路即N-1台路由器，
* 网络无拥塞，即节点无排队时延，
* 每台主机和路由器的处理时延都为 $d_{proc}$，
* 每个节点输出速率都为R bps，分组长度为L bit，即传输时延$d_{trans} = L / R$，
* 链路的传播时延都为 $d_{prop}$

则：端到端延时$d_{end-end} = N(d_{proc} + d_{trans} + d_{prop})$

### Traceroute

路由追踪软件(windows下为tracert)，采用ICMP协议

### 端系统时延

端系统除了处理时延、传输时延和传播时延外，还有一些其他时延（应用程序刻意或者某些协议的时延）

## 计算机网络中的吞吐量

```plantuml
@startmindmap
* 端到端吞吐量(源主机和目的主机之间的数据传输速率，单位bps)
** 瞬间吞吐量
***_ 一个时刻的速率
** 平均吞吐量
***_ 一段时间的速率
@endmindmap
```
多条链路组成的网络，最慢的链路称**瓶颈链路**。  
假设服务器和客户端之间具有N条链路的网络，这N条链路的传输速率分别是R1，R2...Rn，则服务器到客户端的吞吐量为min{R1, R2...Rn}  

因特网中核心的公共链路本身传输速率很大，但是由于其是共享的，所以速率会被稀释(TCP协议会平分速率)。
