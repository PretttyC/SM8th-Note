# 网络应用原理

## 网络应用体系结构

```plantuml
@startmindmap
* 网络应用体系结构
** C/S 客户-服务器体系结构
***:\
===服务器主机总是处于打开状态，它服务于客户主机的请求。

===客户服务器体系中，客户之间不直接通信。

===服务器具有固定、公开的IP地址。;

** P2P 对等体系结构
***:\
===不依赖(或很少依赖)专用服务器。

===主机和主机之间直接通信，这些主机对称为对等方。

===P2P具有自扩展性：每个对等方都由于请求而产生工作负载，但同时也向其他主机提供服务。

===P2P具有成本效率：不需要服务器基础设施和带宽。;

** C/S和P2P混合
@endmindmap
```

## 进程通信

* 网络应用程序  
**网络应用程序**由成对的进程组成，  
端系统之间的通信实际是进程(不同端系统)之间的通信。  

* 客户端和服务端  
网络应用程序由成对的进程组成，这对进程在某个通信会话场景中，发起通信的进程称为**客户**；会话开始后等待联系的进程是**服务器**。  
也可以使用术语“**应用程序**的**客户端**”和“**应用程序**的**服务端**”。  
P2P体系中，每个主机既可以是客户也可以是服务器。

* 套接字  
**套接字**是进程向网络发送和接收报文的软件接口，也称为应用程序和网络之间的API(应用程序编程接口)。 
**套接字**是应用层和传输层之间的接口。  

使用socket API来通信时，socket API会返回一个套接字整数标识(socket)，操作系统使用这个socket整数来标识通信会话。  
就像操作系统打开文件返回的fd(文件描述符或句柄)一样，对fd的操作就是对文件的操作。  
后续可使用这个socket整数来进行通信

```plantuml
@startmindmap
* socket
** TCP socket
***:\
==- TCP socket唯一标识了通信双方之间的通信会话

==- TCP socket代表了一个4元组信息：(源IP、源端口、目的IP、目的端口)
===(TCP面向连接，需要维护连接状态，所以需要通信双方的IP和端口)
;

** UDP socket
***:\
==- UDP socket标识了通信的一个端节点(end point)

==- UDP socket代表了一个2元组信息：(本地IP、本地端口)
===(UDP是无连接的协议，不需要维护连接状态，目的IP和目的端口并不固化在Socket 中，而是在每次发送数据时动态指定，所以只需要本地IP和本地端口);
@endmindmap
```

```plantuml
@startmindmap
* 套接字的具体用途
** 应用程序开发者可以控制套接字在**应用层**的一切
** 应用程序开发者对套接字在**传输层**的控制仅限于
***:\
=== - 选择传输层协议。

=== - 设定几个传输层参数：如最大缓存、最大报文段长度。;
@endmindmap
```

* 进程寻址  

```plantuml
@startmindmap
* 标识进程的两种信息
** IP地址
***_ 用于唯一标识主机的地址
** 端口号
***_ 用于区分主机上的具体进程
***_ 流行的应用已分配了特定的端口号，如Web端口80，SMTP协议端口25
@endmindmap
```


## 供应用程序使用的运输服务

```plantuml
@startmindmap
* 传输层协议可提供服务的4个方面
** 可靠数据传输(数据丢失率)
***_ 保障数据最终能到达目的地。若提供的是不可靠传输服务，则表示可以容忍数据丢失；比如多媒体应用

** 吞吐量
***_ 确保吞吐量总是在某个值以上
**** 带宽敏感的应用
*****_ 对吞吐量有要求的应用
**** 弹性应用
*****_ 能够根据可用的带宽实时调整使用的吞吐量

** 延迟(确定的时延)
***_ 确保时延在某个值以下

** 安全性
***_ 数据加密
***_ 完整性鉴别
***_ 端点鉴别

*:\
=因特网(TCP/IP网络)的传输层协议
(如今的因特网无法对“确定时延”和“吞吐量”提供保证);
** TCP
*** 面向连接的服务
****_ 通信之前要先通过握手建立连接，通信结束后要释放连接
*** 可靠数据传输服务
****_ 保证有序、无差错的交付发送的数据
*** 流量控制
****_ 发送方不会淹没接收方
*** 拥塞控制
****_:\
===- 发送方和接收方之间网络拥塞时，tcp会抑制发送方的发送速率。

===- TCP限制每个TCP连接，使他们能公平共享带宽;
*** TCP不保证安全性(明文传输)
**** TLS(Transport Layer Security，传输层安全)
*****:\
===- TLS是SSL(Secure Sockets Layer, 安全套接字层)的继承者，SSL由网景公司（Netscape）开发，TSL由IETF（互联网工程任务组）发布

===- 提供数据加密、数据完整性鉴别和端点鉴别服务
===- TLS时对TCP的加强，不在传输层，而在**应用层**实现

===- 应用程序要使用TLS服务，需要在客户端和服务端集成TLS代码(现有的TLS库)。TLS有自己的套接字API，类似于传统的TCP套接字API。;

** UDP
*** 无连接服务
****_ 通信前没有握手过程
*** 不可靠数据传输
****_ 不保证报文能到达接收端，也不保证到达的报文有序
*** 没有流量控制
*** 没有拥塞控制
*** UDP不保证安全性(明文传输)
**** DTLS协议，与TCP的TLS对应；或者QUIC(Quick UDP Internet Connection)协议
@endmindmap
```

## 应用层协议

应用层协议定义了不同端系统上的应用程序进程之间如何进行报文交互。

应用层协议是网络应用的一部分；如：HTTP协议是Web应用的一部分。

```plantuml
@startmindmap
* 应用层协议
** 公有协议
***_ 由RFC定义，如：HTTP、SMTP
** 专用(私有)协议
***_ 如Skype
@endmindmap
```